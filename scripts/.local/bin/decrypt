#!/usr/bin/env bash
generate_key() {
  if [ -f "$HOME/.key" ]; then
    cat "$HOME/.key"
  fi
}
key="$(generate_key)"

while getopts "k:" arg; do
  case $arg in
    k)
      key="$OPTARG"
      ;;
    *)
      ;;
  esac
done
shift $((OPTIND - 1))

input=${1:-$(cat)}

IFS=, read -r iv encrypted <<<"$input"

decrypt_content() {
  echo -n "$encrypted" |
    xxd -r -p |
    openssl enc -aes-256-cbc -d -K "$key" -iv "$iv" |
    xxd -r -p
  exit
}

printf "%s\n" "$(decrypt_content)"

