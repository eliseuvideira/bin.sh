#!/usr/bin/env bash
OPTIONS=$(getopt -o k: -l keys: -- "$@")
eval set -- "$OPTIONS"
while true; do
  case "$1" in
    -k | --keys)
      keys="$2"
      shift 2
      ;;
    --)
      shift
      break
      ;;
    *)
      shift
      ;;
  esac
done


usage() {
  printf "json_config: usage: json_config [-k|--keys=key1,key2,...] json_file\n" >&2
}

exit_with_error() {
  printf "json_config: error: %s\n" "$1" >&2
  usage
  exit 1
}

json_file="$1"
if [ -z "$json_file" ]; then
  exit_with_error "missing json_file argument"
fi
if [ -n "$keys" ]; then
  jq_filter=$(printf "%s" "$keys" | sed -E 's/^/./;s/,/,./g')
  jq -Mr "${jq_filter}" "$json_file" | paste -s -d ,
else
  jq -Mc '.' "$json_file"
fi

